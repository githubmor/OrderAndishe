//------------------------------------------------------------------------------
// <auto-generated>
//     This code was generated by a tool
//     Changes to this file will be lost if the code is regenerated.
// </auto-generated>
//------------------------------------------------------------------------------
namespace BL
{
	using System;
	using System.Collections.Generic;
	using System.Linq;
	using System.Text;
    using OrdersAndisheh.DL;
    using OrdersAndisheh.BL;


    /// <summary>
    /// This is Just For Service Sefaresh To Database
    /// </summary>
	public class SefareshService
	{
        //public virtual Sefaresh Sefareshs
        //{
        //    get;
        //    set;
        //}

		public void SaveSefaresh(Sefaresh sefaresh)
		{
            if (sefaresh.Order != null)
            {
                using (MyContext db = new MyContext())
                {
                    db.Order.Add(sefaresh.Order);
                    db.SaveChanges();
                }
            }
		}

        public void UpdateSefaresh(Sefaresh sefaresh)
		{
            if (sefaresh.Order != null)
            {
                using (MyContext db = new MyContext())
                {
                    db.Order.Attach(sefaresh.Order);
                    db.SaveChanges();
                }
            }
		}

        public virtual void AcceptSefaresh(Sefaresh sefaresh)
		{
            if (sefaresh.Items==null)
            {
                throw new ApplicationException("آیتم ها سفارش نهای میباشد");
            }
            foreach (var item in sefaresh.Items)
            {
                if (item.Maghsad==""|item.Ranande==""|item.Tedad>0)
                {
                    throw new ApplicationException("اطلاعات مناسب وارد نشده");
                }
            }
            sefaresh.Accepted = true;
            this.UpdateSefaresh(sefaresh);
		}

        public virtual void UnAcceptSefaresh(Sefaresh sefaresh)
		{
            if (sefaresh.Items == null)
            {
                throw new ApplicationException("");
            }
            sefaresh.Accepted = false;
            this.UpdateSefaresh(sefaresh);
		}

        //private void PrintReports(Sefaresh sefaresh)
        //{
        //    ReportManager rm = new ReportManager(sefaresh);

        //    rm.CreatBazresReport();
        //    rm.CreatAnbarReport();
        //    rm.CreatImenSazanReport();
        //    rm.CreatKontrolReport();
        //    rm.CreatListErsalReport();
        //}

	}
}

